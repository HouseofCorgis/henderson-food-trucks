(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3],{6820:function(e,t,s){Promise.resolve().then(s.bind(s,6683))},6683:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return a}});var n=s(7437),r=s(2265),i=s(9376),l=s(5526);function a(){let[e,t]=(0,r.useState)(null),[s,a]=(0,r.useState)(!0),[m,h]=(0,r.useState)("schedule"),[x,g]=(0,r.useState)([]),[p,b]=(0,r.useState)([]),[f,v]=(0,r.useState)([]),[j,N]=(0,r.useState)([]),[y,w]=(0,r.useState)(""),k=(0,i.useRouter)(),_=(0,l.j5)(null==e?void 0:e.email);async function C(){let e=await (0,l.ts)();if(!e){k.push("/admin/login");return}t(e),await S(e)}async function S(e){a(!0);let t=e.email||"",{data:s}=await l.OQ.from("venues").select("*").order("name");v(s||[]);let n=await (0,l.IF)(t);if(g(n),(0,l.j5)(t)){let{data:e}=await l.OQ.from("trucks").select("*").order("name");b(e||[])}let r=n.map(e=>e.id);N(await (0,l.K4)(t,r)),a(!1)}async function D(){await (0,l.w7)(),k.push("/admin/login")}function T(e){w(e),setTimeout(()=>w(""),3e3)}return((0,r.useEffect)(()=>{C()},[]),s)?(0,n.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-stone-100",children:(0,n.jsx)("div",{className:"text-xl text-stone-600",children:"Loading..."})}):e?(0,n.jsxs)("div",{className:"min-h-screen bg-stone-100",children:[(0,n.jsx)("header",{className:"bg-ridge-700 text-white p-4 shadow-lg",children:(0,n.jsxs)("div",{className:"max-w-6xl mx-auto flex items-center justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"text-2xl font-display font-bold",children:"\uD83D\uDE9A Food Truck Admin"}),(0,n.jsx)("p",{className:"text-ridge-200 text-sm",children:_?"\uD83D\uDC51 Super Admin":"Managing: ".concat(x.map(e=>e.name).join(", ")||"No trucks assigned")})]}),(0,n.jsxs)("div",{className:"flex items-center gap-4",children:[(0,n.jsx)("span",{className:"text-ridge-200 text-sm hidden sm:block",children:e.email}),(0,n.jsx)("button",{onClick:D,className:"px-4 py-2 bg-ridge-600 hover:bg-ridge-500 rounded-lg text-sm transition-colors",children:"Sign Out"})]})]})}),y&&(0,n.jsx)("div",{className:"bg-green-500 text-white p-3 text-center font-medium",children:y}),(0,n.jsxs)("div",{className:"max-w-6xl mx-auto p-4",children:[(0,n.jsx)("div",{className:"flex flex-wrap gap-2 mb-6",children:["schedule","trucks",..._?["venues","users"]:[]].map(e=>(0,n.jsxs)("button",{onClick:()=>h(e),className:"px-6 py-3 rounded-lg font-semibold capitalize transition-all ".concat(m===e?"bg-ridge-600 text-white shadow-md":"bg-white text-stone-600 hover:bg-stone-50"),children:["users"===e?"\uD83D\uDC65 Manage Users":e,"trucks"===e&&" (".concat(x.length,")"),"venues"===e&&" (".concat(f.length,")"),"schedule"===e&&" (".concat(j.length,")")]},e))}),(0,n.jsx)("div",{className:"mb-4",children:(0,n.jsx)("a",{href:"/",className:"text-ridge-600 hover:text-ridge-700 text-sm",children:"← Back to site"})}),"trucks"===m&&(0,n.jsx)(d,{trucks:x,isAdmin:_,onUpdate:()=>e&&S(e),showMessage:T}),"venues"===m&&_&&(0,n.jsx)(o,{venues:f,onUpdate:()=>e&&S(e),showMessage:T}),"schedule"===m&&(0,n.jsx)(c,{schedule:j,trucks:x,venues:f,isAdmin:_,onUpdate:()=>e&&S(e),showMessage:T}),"users"===m&&_&&(0,n.jsx)(u,{trucks:p,onUpdate:()=>e&&S(e),showMessage:T})]})]}):null}function d(e){let{trucks:t,isAdmin:s,onUpdate:i,showMessage:a}=e,[d,o]=(0,r.useState)(null),[c,u]=(0,r.useState)({name:"",description:"",cuisine_type:"",phone:"",facebook:"",instagram:""});async function m(e){e.preventDefault();try{d?(await (0,l.Au)(d,c),a("Truck updated!")):s&&(await (0,l.Gu)({...c,user_id:null}),a("Truck added!")),u({name:"",description:"",cuisine_type:"",phone:"",facebook:"",instagram:""}),o(null),i()}catch(e){a("Error: "+e.message)}}async function h(e){if(confirm("Delete this truck? This will also delete all their schedule entries."))try{await (0,l.$K)(e),a("Truck deleted"),i()}catch(e){a("Error: "+e.message)}}return s||0!==t.length?(0,n.jsxs)("div",{className:"grid lg:grid-cols-3 gap-6",children:[(0,n.jsx)("div",{className:"lg:col-span-1",children:(0,n.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-6",children:[(0,n.jsx)("h2",{className:"text-lg font-bold text-stone-900 mb-4",children:d?"Edit Truck":s?"Add New Truck":"Edit Your Truck"}),(0,n.jsxs)("form",{onSubmit:m,className:"space-y-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-stone-700 mb-1",children:"Name *"}),(0,n.jsx)("input",{type:"text",required:!0,value:c.name,onChange:e=>u({...c,name:e.target.value}),disabled:!s&&!d,className:"w-full px-3 py-2 border border-stone-300 rounded-lg focus:ring-2 focus:ring-ridge-500 focus:border-ridge-500 disabled:bg-stone-100"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-stone-700 mb-1",children:"Description"}),(0,n.jsx)("textarea",{value:c.description,onChange:e=>u({...c,description:e.target.value}),rows:2,className:"w-full px-3 py-2 border border-stone-300 rounded-lg focus:ring-2 focus:ring-ridge-500 focus:border-ridge-500"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-stone-700 mb-1",children:"Cuisine Type"}),(0,n.jsxs)("select",{value:c.cuisine_type,onChange:e=>u({...c,cuisine_type:e.target.value}),className:"w-full px-3 py-2 border border-stone-300 rounded-lg focus:ring-2 focus:ring-ridge-500 focus:border-ridge-500",children:[(0,n.jsx)("option",{value:"",children:"Select..."}),["BBQ","Mexican","Burgers","Pizza","American","Seafood","South American","Mediterranean","Desserts","Coffee","Other"].map(e=>(0,n.jsx)("option",{value:e,children:e},e))]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-stone-700 mb-1",children:"Phone"}),(0,n.jsx)("input",{type:"tel",value:c.phone,onChange:e=>u({...c,phone:e.target.value}),className:"w-full px-3 py-2 border border-stone-300 rounded-lg focus:ring-2 focus:ring-ridge-500 focus:border-ridge-500",placeholder:"(828) 555-0100"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-stone-700 mb-1",children:"Facebook URL"}),(0,n.jsx)("input",{type:"url",value:c.facebook,onChange:e=>u({...c,facebook:e.target.value}),className:"w-full px-3 py-2 border border-stone-300 rounded-lg focus:ring-2 focus:ring-ridge-500 focus:border-ridge-500",placeholder:"https://facebook.com/..."})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-stone-700 mb-1",children:"Instagram URL"}),(0,n.jsx)("input",{type:"url",value:c.instagram,onChange:e=>u({...c,instagram:e.target.value}),className:"w-full px-3 py-2 border border-stone-300 rounded-lg focus:ring-2 focus:ring-ridge-500 focus:border-ridge-500",placeholder:"https://instagram.com/..."})]}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(s||d)&&(0,n.jsx)("button",{type:"submit",className:"flex-1 bg-ridge-600 hover:bg-ridge-700 text-white py-2 px-4 rounded-lg font-semibold transition-colors",children:d?"Update":"Add Truck"}),d&&(0,n.jsx)("button",{type:"button",onClick:()=>{o(null),u({name:"",description:"",cuisine_type:"",phone:"",facebook:"",instagram:""})},className:"px-4 py-2 bg-stone-200 hover:bg-stone-300 rounded-lg",children:"Cancel"})]})]})]})}),(0,n.jsx)("div",{className:"lg:col-span-2",children:(0,n.jsxs)("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden",children:[(0,n.jsx)("div",{className:"p-4 border-b border-stone-200",children:(0,n.jsx)("h2",{className:"font-bold text-stone-900",children:s?"All Trucks (".concat(t.length,")"):"Your Truck"})}),0===t.length?(0,n.jsx)("div",{className:"p-8 text-center text-stone-500",children:"No trucks yet. Add your first one!"}):(0,n.jsx)("div",{className:"divide-y divide-stone-100",children:t.map(e=>(0,n.jsxs)("div",{className:"p-4 flex items-center justify-between hover:bg-stone-50",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"font-semibold text-stone-900",children:e.name}),(0,n.jsxs)("div",{className:"text-sm text-stone-500",children:[e.cuisine_type||"No cuisine set",e.phone&&" • ".concat(e.phone),e.user_id&&s&&(0,n.jsxs)("span",{className:"ml-2 text-ridge-600",children:["• Assigned to: ",e.user_id]})]})]}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)("button",{onClick:()=>{o(e.id),u({name:e.name,description:e.description||"",cuisine_type:e.cuisine_type||"",phone:e.phone||"",facebook:e.facebook||"",instagram:e.instagram||""})},className:"px-3 py-1 text-sm bg-stone-100 hover:bg-stone-200 rounded-lg",children:"Edit"}),s&&(0,n.jsx)("button",{onClick:()=>h(e.id),className:"px-3 py-1 text-sm bg-red-100 hover:bg-red-200 text-red-700 rounded-lg",children:"Delete"})]})]},e.id))})]})})]}):(0,n.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-8 text-center",children:[(0,n.jsx)("p",{className:"text-stone-500",children:"No trucks assigned to your account yet."}),(0,n.jsx)("p",{className:"text-stone-400 text-sm mt-2",children:"Contact the admin to get your truck linked."})]})}function o(e){let{venues:t,onUpdate:s,showMessage:i}=e,[a,d]=(0,r.useState)(null),[o,c]=(0,r.useState)({name:"",description:"",address:"",lat:"",lng:"",type:"brewery",phone:"",website:""});async function u(e){e.preventDefault();try{let e={...o,lat:o.lat?parseFloat(o.lat):null,lng:o.lng?parseFloat(o.lng):null};a?(await (0,l.NZ)(a,e),i("Venue updated!")):(await (0,l.nY)(e),i("Venue added!")),c({name:"",description:"",address:"",lat:"",lng:"",type:"brewery",phone:"",website:""}),d(null),s()}catch(e){i("Error: "+e.message)}}async function m(e){if(confirm("Delete this venue?"))try{await (0,l.zJ)(e),i("Venue deleted"),s()}catch(e){i("Error: "+e.message)}}return(0,n.jsxs)("div",{className:"grid lg:grid-cols-3 gap-6",children:[(0,n.jsx)("div",{className:"lg:col-span-1",children:(0,n.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-6",children:[(0,n.jsx)("h2",{className:"text-lg font-bold text-stone-900 mb-4",children:a?"Edit Venue":"Add New Venue"}),(0,n.jsxs)("form",{onSubmit:u,className:"space-y-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-stone-700 mb-1",children:"Name *"}),(0,n.jsx)("input",{type:"text",required:!0,value:o.name,onChange:e=>c({...o,name:e.target.value}),className:"w-full px-3 py-2 border border-stone-300 rounded-lg focus:ring-2 focus:ring-ridge-500 focus:border-ridge-500"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-stone-700 mb-1",children:"Type"}),(0,n.jsx)("select",{value:o.type,onChange:e=>c({...o,type:e.target.value}),className:"w-full px-3 py-2 border border-stone-300 rounded-lg focus:ring-2 focus:ring-ridge-500 focus:border-ridge-500",children:["brewery","winery","park","event-space","market","taproom","other"].map(e=>(0,n.jsx)("option",{value:e,children:e.replace("-"," ")},e))})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-stone-700 mb-1",children:"Address"}),(0,n.jsx)("input",{type:"text",value:o.address,onChange:e=>c({...o,address:e.target.value}),className:"w-full px-3 py-2 border border-stone-300 rounded-lg focus:ring-2 focus:ring-ridge-500 focus:border-ridge-500",placeholder:"123 Main St, Hendersonville, NC"})]}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-stone-700 mb-1",children:"Latitude"}),(0,n.jsx)("input",{type:"text",value:o.lat,onChange:e=>c({...o,lat:e.target.value}),className:"w-full px-3 py-2 border border-stone-300 rounded-lg focus:ring-2 focus:ring-ridge-500 focus:border-ridge-500",placeholder:"35.3187"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-stone-700 mb-1",children:"Longitude"}),(0,n.jsx)("input",{type:"text",value:o.lng,onChange:e=>c({...o,lng:e.target.value}),className:"w-full px-3 py-2 border border-stone-300 rounded-lg focus:ring-2 focus:ring-ridge-500 focus:border-ridge-500",placeholder:"-82.4612"})]})]}),(0,n.jsx)("p",{className:"text-xs text-stone-500",children:"Tip: Search the address on Google Maps, right-click the location, and copy the coordinates."}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-stone-700 mb-1",children:"Phone"}),(0,n.jsx)("input",{type:"tel",value:o.phone,onChange:e=>c({...o,phone:e.target.value}),className:"w-full px-3 py-2 border border-stone-300 rounded-lg focus:ring-2 focus:ring-ridge-500 focus:border-ridge-500"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-stone-700 mb-1",children:"Website"}),(0,n.jsx)("input",{type:"url",value:o.website,onChange:e=>c({...o,website:e.target.value}),className:"w-full px-3 py-2 border border-stone-300 rounded-lg focus:ring-2 focus:ring-ridge-500 focus:border-ridge-500",placeholder:"https://..."})]}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)("button",{type:"submit",className:"flex-1 bg-ridge-600 hover:bg-ridge-700 text-white py-2 px-4 rounded-lg font-semibold transition-colors",children:a?"Update":"Add Venue"}),a&&(0,n.jsx)("button",{type:"button",onClick:()=>{d(null),c({name:"",description:"",address:"",lat:"",lng:"",type:"brewery",phone:"",website:""})},className:"px-4 py-2 bg-stone-200 hover:bg-stone-300 rounded-lg",children:"Cancel"})]})]})]})}),(0,n.jsx)("div",{className:"lg:col-span-2",children:(0,n.jsxs)("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden",children:[(0,n.jsx)("div",{className:"p-4 border-b border-stone-200",children:(0,n.jsxs)("h2",{className:"font-bold text-stone-900",children:["All Venues (",t.length,")"]})}),0===t.length?(0,n.jsx)("div",{className:"p-8 text-center text-stone-500",children:"No venues yet. Add your first one!"}):(0,n.jsx)("div",{className:"divide-y divide-stone-100",children:t.map(e=>(0,n.jsxs)("div",{className:"p-4 flex items-center justify-between hover:bg-stone-50",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"font-semibold text-stone-900",children:e.name}),(0,n.jsxs)("div",{className:"text-sm text-stone-500",children:[e.type," • ",e.address||"No address"]})]}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)("button",{onClick:()=>{var t,s;d(e.id),c({name:e.name,description:e.description||"",address:e.address||"",lat:(null===(t=e.lat)||void 0===t?void 0:t.toString())||"",lng:(null===(s=e.lng)||void 0===s?void 0:s.toString())||"",type:e.type||"brewery",phone:e.phone||"",website:e.website||""})},className:"px-3 py-1 text-sm bg-stone-100 hover:bg-stone-200 rounded-lg",children:"Edit"}),(0,n.jsx)("button",{onClick:()=>m(e.id),className:"px-3 py-1 text-sm bg-red-100 hover:bg-red-200 text-red-700 rounded-lg",children:"Delete"})]})]},e.id))})]})})]})}function c(e){let{schedule:t,trucks:s,venues:i,isAdmin:a,onUpdate:d,showMessage:o}=e,[c,u]=(0,r.useState)(null),[m,h]=(0,r.useState)("single"),[x,g]=(0,r.useState)({truck_id:"",venue_id:"",date:"",start_time:"17:00",end_time:"21:00",event_name:"",other_truck_name:"",other_venue_name:""}),[p,b]=(0,r.useState)([]),[f,v]=(0,r.useState)(0),[j,N]=(0,r.useState)(""),y=new Date().toISOString().split("T")[0],w=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];function k(e,t){let s=[],n=new Date(t+"T12:00:00"),r=new Date;for(;r.getDay()!==e;)r.setDate(r.getDate()+1);for(;r<=n;)s.push(r.toISOString().split("T")[0]),r.setDate(r.getDate()+7);return s}async function _(e){e.preventDefault();try{if("other"===x.truck_id&&!x.other_truck_name.trim()){o("Please enter the truck name");return}if("other"===x.venue_id&&!x.other_venue_name.trim()){o("Please enter the venue name");return}let e={truck_id:"other"===x.truck_id?null:x.truck_id,venue_id:"other"===x.venue_id?null:x.venue_id,start_time:x.start_time,end_time:x.end_time,event_name:x.event_name||null,other_truck_name:"other"===x.truck_id?x.other_truck_name.trim():null,other_venue_name:"other"===x.venue_id?x.other_venue_name.trim():null};if(c)await (0,l._p)(c,{...e,date:x.date}),o("Schedule updated!"),g({truck_id:1===s.length?s[0].id:"",venue_id:"",date:"",start_time:"17:00",end_time:"21:00",event_name:"",other_truck_name:"",other_venue_name:""}),u(null);else{let t=[];if("single"===m?t=[x.date]:"multiple"===m?t=p:"recurring"===m&&(t=k(f,j)),0===t.length){o("Please select at least one date");return}for(let s of t)await (0,l.ZK)({...e,date:s});o("Added ".concat(t.length," schedule ").concat(1===t.length?"entry":"entries","!")),g({truck_id:1===s.length?s[0].id:"",venue_id:"",date:"",start_time:"17:00",end_time:"21:00",event_name:"",other_truck_name:"",other_venue_name:""}),b([]),N("")}d()}catch(e){o("Error: "+e.message)}}async function C(e){if(confirm("Delete this schedule entry?"))try{await (0,l.D$)(e),o("Schedule deleted"),d()}catch(e){o("Error: "+e.message)}}(0,r.useEffect)(()=>{1!==s.length||x.truck_id||g(e=>({...e,truck_id:s[0].id}))},[s,x.truck_id]);let S=(e,t)=>{var n;return!e&&t?t.other_truck_name||"Other Truck":(null===(n=s.find(t=>t.id===e))||void 0===n?void 0:n.name)||"Unknown"},D=(e,t)=>{var s;return!e&&t?t.other_venue_name||"Other Venue":(null===(s=i.find(t=>t.id===e))||void 0===s?void 0:s.name)||"Unknown"},T=e=>new Date(e+"T12:00:00").toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),E=e=>{let[t,s]=e.split(":"),n=parseInt(t);return"".concat(n%12||12,":").concat(s," ").concat(n>=12?"PM":"AM")},A=t.filter(e=>e.date>=y),I=t.filter(e=>e.date<y),U=function(e){let t=[];for(let e=0;e<30;e++){let s=new Date;s.setDate(s.getDate()+e);let n=s.toISOString().split("T")[0];t.push({date:n,dayName:w[s.getDay()],display:s.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})})}return t}(0);return 0===s.length?(0,n.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-8 text-center",children:[(0,n.jsx)("p",{className:"text-stone-500",children:"No trucks assigned to your account yet."}),(0,n.jsx)("p",{className:"text-stone-400 text-sm mt-2",children:"Contact the admin to get your truck linked."})]}):(0,n.jsxs)("div",{className:"grid lg:grid-cols-3 gap-6",children:[(0,n.jsx)("div",{className:"lg:col-span-1",children:(0,n.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-6",children:[(0,n.jsx)("h2",{className:"text-lg font-bold text-stone-900 mb-4",children:c?"Edit Schedule":"Add Schedule Entry"}),(0,n.jsxs)("form",{onSubmit:_,className:"space-y-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-stone-700 mb-1",children:"Truck *"}),(0,n.jsxs)("select",{required:!0,value:x.truck_id,onChange:e=>g({...x,truck_id:e.target.value,other_truck_name:"other"===e.target.value?x.other_truck_name:""}),className:"w-full px-3 py-2 border border-stone-300 rounded-lg focus:ring-2 focus:ring-ridge-500 focus:border-ridge-500",children:[(0,n.jsx)("option",{value:"",children:"Select a truck..."}),s.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id)),(0,n.jsx)("option",{value:"other",children:"➕ Other (one-time)"})]}),"other"===x.truck_id&&(0,n.jsx)("input",{type:"text",placeholder:"Enter truck name...",value:x.other_truck_name,onChange:e=>g({...x,other_truck_name:e.target.value}),className:"w-full mt-2 px-3 py-2 border border-stone-300 rounded-lg focus:ring-2 focus:ring-ridge-500 focus:border-ridge-500",required:!0})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-stone-700 mb-1",children:"Venue *"}),(0,n.jsxs)("select",{required:!0,value:x.venue_id,onChange:e=>g({...x,venue_id:e.target.value,other_venue_name:"other"===e.target.value?x.other_venue_name:""}),className:"w-full px-3 py-2 border border-stone-300 rounded-lg focus:ring-2 focus:ring-ridge-500 focus:border-ridge-500",children:[(0,n.jsx)("option",{value:"",children:"Select a venue..."}),i.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id)),(0,n.jsx)("option",{value:"other",children:"➕ Other (one-time)"})]}),"other"===x.venue_id&&(0,n.jsx)("input",{type:"text",placeholder:"Enter venue name/location...",value:x.other_venue_name,onChange:e=>g({...x,other_venue_name:e.target.value}),className:"w-full mt-2 px-3 py-2 border border-stone-300 rounded-lg focus:ring-2 focus:ring-ridge-500 focus:border-ridge-500",required:!0})]}),!c&&(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:"Date Selection Mode"}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)("button",{type:"button",onClick:()=>h("single"),className:"flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ".concat("single"===m?"bg-ridge-600 text-white":"bg-stone-100 text-stone-600 hover:bg-stone-200"),children:"Single"}),(0,n.jsx)("button",{type:"button",onClick:()=>h("multiple"),className:"flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ".concat("multiple"===m?"bg-ridge-600 text-white":"bg-stone-100 text-stone-600 hover:bg-stone-200"),children:"Multiple"}),(0,n.jsx)("button",{type:"button",onClick:()=>h("recurring"),className:"flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ".concat("recurring"===m?"bg-ridge-600 text-white":"bg-stone-100 text-stone-600 hover:bg-stone-200"),children:"Weekly"})]})]}),("single"===m||c)&&(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-stone-700 mb-1",children:"Date *"}),(0,n.jsx)("input",{type:"date",required:!0,value:x.date,onChange:e=>g({...x,date:e.target.value}),min:y,className:"w-full px-3 py-2 border border-stone-300 rounded-lg focus:ring-2 focus:ring-ridge-500 focus:border-ridge-500"})]}),"multiple"===m&&!c&&(0,n.jsxs)("div",{children:[(0,n.jsxs)("label",{className:"block text-sm font-medium text-stone-700 mb-2",children:["Select Dates (",p.length," selected)"]}),(0,n.jsx)("div",{className:"max-h-48 overflow-y-auto border border-stone-200 rounded-lg p-2 space-y-1",children:U.map(e=>{let{date:t,display:s}=e;return(0,n.jsxs)("label",{className:"flex items-center gap-2 p-2 rounded cursor-pointer transition-colors ".concat(p.includes(t)?"bg-ridge-100":"hover:bg-stone-50"),children:[(0,n.jsx)("input",{type:"checkbox",checked:p.includes(t),onChange:()=>{b(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t].sort())},className:"w-4 h-4 text-ridge-600 rounded focus:ring-ridge-500"}),(0,n.jsx)("span",{className:"text-sm",children:s})]},t)})}),p.length>0&&(0,n.jsx)("button",{type:"button",onClick:()=>b([]),className:"mt-2 text-sm text-stone-500 hover:text-stone-700",children:"Clear selection"})]}),"recurring"===m&&!c&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-stone-700 mb-1",children:"Every *"}),(0,n.jsx)("select",{value:f,onChange:e=>v(parseInt(e.target.value)),className:"w-full px-3 py-2 border border-stone-300 rounded-lg focus:ring-2 focus:ring-ridge-500 focus:border-ridge-500",children:w.map((e,t)=>(0,n.jsx)("option",{value:t,children:e},e))})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-stone-700 mb-1",children:"Until *"}),(0,n.jsx)("input",{type:"date",required:"recurring"===m,value:j,onChange:e=>N(e.target.value),min:y,className:"w-full px-3 py-2 border border-stone-300 rounded-lg focus:ring-2 focus:ring-ridge-500 focus:border-ridge-500"}),j&&(0,n.jsxs)("p",{className:"mt-1 text-xs text-stone-500",children:["Will create ",k(f,j).length," entries"]})]})]}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-stone-700 mb-1",children:"Start Time *"}),(0,n.jsx)("input",{type:"time",required:!0,value:x.start_time,onChange:e=>g({...x,start_time:e.target.value}),className:"w-full px-3 py-2 border border-stone-300 rounded-lg focus:ring-2 focus:ring-ridge-500 focus:border-ridge-500"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-stone-700 mb-1",children:"End Time *"}),(0,n.jsx)("input",{type:"time",required:!0,value:x.end_time,onChange:e=>g({...x,end_time:e.target.value}),className:"w-full px-3 py-2 border border-stone-300 rounded-lg focus:ring-2 focus:ring-ridge-500 focus:border-ridge-500"})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-stone-700 mb-1",children:"Event Name (optional)"}),(0,n.jsx)("input",{type:"text",value:x.event_name,onChange:e=>g({...x,event_name:e.target.value}),className:"w-full px-3 py-2 border border-stone-300 rounded-lg focus:ring-2 focus:ring-ridge-500 focus:border-ridge-500",placeholder:"e.g., Farmers Market, Live Music Night"})]}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)("button",{type:"submit",className:"flex-1 bg-ridge-600 hover:bg-ridge-700 text-white py-2 px-4 rounded-lg font-semibold transition-colors",children:c?"Update":"single"===m?"Add to Schedule":"Add ".concat("multiple"===m?p.length:k(f,j).length||0," Entries")}),c&&(0,n.jsx)("button",{type:"button",onClick:()=>{u(null),g({truck_id:1===s.length?s[0].id:"",venue_id:"",date:"",start_time:"17:00",end_time:"21:00",event_name:"",other_truck_name:"",other_venue_name:""})},className:"px-4 py-2 bg-stone-200 hover:bg-stone-300 rounded-lg",children:"Cancel"})]})]})]})}),(0,n.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,n.jsxs)("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden",children:[(0,n.jsx)("div",{className:"p-4 border-b border-stone-200",children:(0,n.jsxs)("h2",{className:"font-bold text-stone-900",children:["Upcoming Schedule (",A.length,")"]})}),0===A.length?(0,n.jsx)("div",{className:"p-8 text-center text-stone-500",children:"No upcoming schedule. Add some entries!"}):(0,n.jsx)("div",{className:"divide-y divide-stone-100",children:A.map(e=>(0,n.jsxs)("div",{className:"p-4 flex items-center justify-between hover:bg-stone-50",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"font-semibold text-stone-900",children:[S(e.truck_id,e)," @ ",D(e.venue_id,e)]}),(0,n.jsxs)("div",{className:"text-sm text-stone-500",children:[T(e.date)," • ",E(e.start_time)," - ",E(e.end_time),e.event_name&&(0,n.jsxs)("span",{className:"ml-2 text-sunset-600",children:["• ",e.event_name]})]})]}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)("button",{onClick:()=>{u(e.id),h("single"),g({truck_id:e.truck_id||"other",venue_id:e.venue_id||"other",date:e.date,start_time:e.start_time,end_time:e.end_time,event_name:e.event_name||"",other_truck_name:e.other_truck_name||"",other_venue_name:e.other_venue_name||""})},className:"px-3 py-1 text-sm bg-stone-100 hover:bg-stone-200 rounded-lg",children:"Edit"}),(0,n.jsx)("button",{onClick:()=>C(e.id),className:"px-3 py-1 text-sm bg-red-100 hover:bg-red-200 text-red-700 rounded-lg",children:"Delete"})]})]},e.id))})]}),I.length>0&&(0,n.jsxs)("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden opacity-60",children:[(0,n.jsx)("div",{className:"p-4 border-b border-stone-200",children:(0,n.jsxs)("h2",{className:"font-bold text-stone-500",children:["Past Schedule (",I.length,")"]})}),(0,n.jsx)("div",{className:"divide-y divide-stone-100",children:I.slice(0,5).map(e=>(0,n.jsxs)("div",{className:"p-4 flex items-center justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"font-semibold text-stone-500",children:[S(e.truck_id,e)," @ ",D(e.venue_id,e)]}),(0,n.jsx)("div",{className:"text-sm text-stone-400",children:T(e.date)})]}),(0,n.jsx)("button",{onClick:()=>C(e.id),className:"px-3 py-1 text-sm bg-stone-100 hover:bg-stone-200 text-stone-500 rounded-lg",children:"Delete"})]},e.id))})]})]})]})}function u(e){let{trucks:t,onUpdate:s,showMessage:i}=e,[a,d]=(0,r.useState)(""),[o,c]=(0,r.useState)("");async function u(e){if(e.preventDefault(),a&&o)try{await (0,l.wP)(a,o),i("Truck assigned to user!"),d(""),c(""),s()}catch(e){i("Error: "+e.message)}}async function m(e){if(confirm("Remove user assignment from this truck?"))try{await (0,l.NH)(e),i("User assignment removed"),s()}catch(e){i("Error: "+e.message)}}let h=t.filter(e=>e.user_id),x=t.filter(e=>!e.user_id);return(0,n.jsxs)("div",{className:"grid lg:grid-cols-2 gap-6",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-6",children:[(0,n.jsx)("h2",{className:"text-lg font-bold text-stone-900 mb-4",children:"Assign Truck to User"}),(0,n.jsx)("p",{className:"text-sm text-stone-500 mb-4",children:"First, invite the user via Supabase Dashboard → Authentication → Users → Invite user. Then enter their email below to link them to a truck."}),(0,n.jsxs)("form",{onSubmit:u,className:"space-y-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-stone-700 mb-1",children:"Truck"}),(0,n.jsxs)("select",{value:a,onChange:e=>d(e.target.value),className:"w-full px-3 py-2 border border-stone-300 rounded-lg focus:ring-2 focus:ring-ridge-500 focus:border-ridge-500",children:[(0,n.jsx)("option",{value:"",children:"Select a truck..."}),x.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-stone-700 mb-1",children:"User Email"}),(0,n.jsx)("input",{type:"email",value:o,onChange:e=>c(e.target.value),placeholder:"truckowner@example.com",className:"w-full px-3 py-2 border border-stone-300 rounded-lg focus:ring-2 focus:ring-ridge-500 focus:border-ridge-500"})]}),(0,n.jsx)("button",{type:"submit",disabled:!a||!o,className:"w-full bg-ridge-600 hover:bg-ridge-700 disabled:bg-stone-300 text-white py-2 px-4 rounded-lg font-semibold transition-colors",children:"Assign Truck"})]})]}),(0,n.jsxs)("div",{className:"bg-sunset-50 rounded-xl p-6 mt-6",children:[(0,n.jsx)("h3",{className:"font-bold text-sunset-800 mb-2",children:"\uD83D\uDCCB How to invite a truck owner:"}),(0,n.jsxs)("ol",{className:"text-sm text-sunset-700 space-y-2 list-decimal list-inside",children:[(0,n.jsxs)("li",{children:["Go to your ",(0,n.jsx)("a",{href:"https://supabase.com/dashboard",target:"_blank",rel:"noopener noreferrer",className:"underline",children:"Supabase Dashboard"})]}),(0,n.jsx)("li",{children:"Select your project → Authentication → Users"}),(0,n.jsx)("li",{children:'Click "Invite user" and enter their email'}),(0,n.jsx)("li",{children:"They'll receive an email to set their password"}),(0,n.jsx)("li",{children:"Come back here and assign their truck"})]})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden",children:[(0,n.jsx)("div",{className:"p-4 border-b border-stone-200",children:(0,n.jsxs)("h2",{className:"font-bold text-stone-900",children:["Assigned Trucks (",h.length,")"]})}),0===h.length?(0,n.jsx)("div",{className:"p-8 text-center text-stone-500",children:"No trucks assigned yet."}):(0,n.jsx)("div",{className:"divide-y divide-stone-100",children:h.map(e=>(0,n.jsxs)("div",{className:"p-4 flex items-center justify-between hover:bg-stone-50",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"font-semibold text-stone-900",children:e.name}),(0,n.jsx)("div",{className:"text-sm text-ridge-600",children:e.user_id})]}),(0,n.jsx)("button",{onClick:()=>m(e.id),className:"px-3 py-1 text-sm bg-red-100 hover:bg-red-200 text-red-700 rounded-lg",children:"Remove"})]},e.id))})]}),(0,n.jsxs)("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden mt-6",children:[(0,n.jsx)("div",{className:"p-4 border-b border-stone-200",children:(0,n.jsxs)("h2",{className:"font-bold text-stone-900",children:["Unassigned Trucks (",x.length,")"]})}),0===x.length?(0,n.jsx)("div",{className:"p-8 text-center text-stone-500",children:"All trucks are assigned!"}):(0,n.jsx)("div",{className:"divide-y divide-stone-100",children:x.map(e=>(0,n.jsxs)("div",{className:"p-4",children:[(0,n.jsx)("div",{className:"font-semibold text-stone-900",children:e.name}),(0,n.jsx)("div",{className:"text-sm text-stone-500",children:e.cuisine_type||"No cuisine set"})]},e.id))})]})]})]})}},5526:function(e,t,s){"use strict";s.d(t,{$K:function(){return u},Au:function(){return c},D$:function(){return b},Gu:function(){return o},IF:function(){return f},K4:function(){return v},NH:function(){return N},NZ:function(){return h},OQ:function(){return n},ZK:function(){return g},_p:function(){return p},j5:function(){return a},nY:function(){return m},ts:function(){return l},w7:function(){return i},wP:function(){return j},zB:function(){return r},zJ:function(){return x}});let n=(0,s(9066).eI)("https://bnmgkgjnkupookrttsfu.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJubWdrZ2pua3Vwb29rcnR0c2Z1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUzMzgwNTEsImV4cCI6MjA4MDkxNDA1MX0.Jzvrb8y-sFk4919j8gYDriI9TGm7-le-2fU80k_BLUI");async function r(e,t){let{data:s,error:r}=await n.auth.signInWithPassword({email:e,password:t});if(r)throw r;return s}async function i(){let{error:e}=await n.auth.signOut();if(e)throw e}async function l(){let{data:{user:e}}=await n.auth.getUser();return e}function a(e){return"jamminjessjams@gmail.com"===e}async function d(){let{data:e,error:t}=await n.from("trucks").select("*").order("name");return t?(console.error("Error fetching trucks:",t),[]):e||[]}async function o(e){let{data:t,error:s}=await n.from("trucks").insert(e).select().single();if(s)throw s;return t}async function c(e,t){let{data:s,error:r}=await n.from("trucks").update(t).eq("id",e).select().single();if(r)throw r;return s}async function u(e){let{error:t}=await n.from("trucks").delete().eq("id",e);if(t)throw t}async function m(e){let{data:t,error:s}=await n.from("venues").insert(e).select().single();if(s)throw s;return t}async function h(e,t){let{data:s,error:r}=await n.from("venues").update(t).eq("id",e).select().single();if(r)throw r;return s}async function x(e){let{error:t}=await n.from("venues").delete().eq("id",e);if(t)throw t}async function g(e){let{data:t,error:s}=await n.from("schedule").insert(e).select().single();if(s)throw s;return t}async function p(e,t){let{data:s,error:r}=await n.from("schedule").update(t).eq("id",e).select().single();if(r)throw r;return s}async function b(e){let{error:t}=await n.from("schedule").delete().eq("id",e);if(t)throw t}async function f(e){if(a(e))return d();let{data:t,error:s}=await n.from("trucks").select("*").eq("user_id",e).order("name");return s?(console.error("Error fetching trucks for user:",s),[]):t||[]}async function v(e,t){if(a(e)){let{data:e,error:t}=await n.from("schedule").select("*").order("date").order("start_time");return t?(console.error("Error fetching schedule:",t),[]):e||[]}let s=t;if(s||(s=(await f(e)).map(e=>e.id)),0===s.length)return[];let{data:r,error:i}=await n.from("schedule").select("*").in("truck_id",s).order("date").order("start_time");return i?(console.error("Error fetching schedule for user:",i),[]):r||[]}async function j(e,t){let{data:s,error:r}=await n.from("trucks").update({user_id:t}).eq("id",e).select().single();if(r)throw r;return s}async function N(e){let{data:t,error:s}=await n.from("trucks").update({user_id:null}).eq("id",e).select().single();if(s)throw s;return t}}},function(e){e.O(0,[658,971,117,744],function(){return e(e.s=6820)}),_N_E=e.O()}]);